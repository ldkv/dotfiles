_subdirectory: template
_templates_suffix: ".j2"
_exclude:
  - "{% if os == windows -%}.zshrc{% endif %}"
  - "{% if os == windows -%}.p10k.zsh{% endif %}"
  - "{% if os == windows -%}{{ setup_script }}.sh{% endif %}"
  - "{% if os != windows -%}PowerShell_profile.ps1{% endif %}"
  - "{% if os != windows -%}{{ setup_script }}.ps1{% endif %}"

_message_before_copy: |
    The template will be generated into "{{ _copier_conf.dst_path }}".
    It is REQUIRED that the target is a sub-directory inside your $HOME directory.
    Otherwise, the dotfiles will not work as expected. Please abort and specify a correct target.

user_name:
  type: str
  help: "Name for git config"
  default: "Vu LE"

user_email:
  type: str
  help: "Email for git config"
  default: "ledkvu@gmail.com"

# Default variables for programming purpose - not included in the prompt
omz_plugins:
  type: str
  help: "List of Oh My Zsh plugins to install"
  when: false
  default: |
    zsh-autosuggestions|https://github.com/zsh-users/zsh-autosuggestions
    fast-syntax-highlighting|https://github.com/zdharma-continuum/fast-syntax-highlighting.git
    ohmyzsh-full-autoupdate|https://github.com/Pilaton/OhMyZsh-full-autoupdate.git

symlink_targets:
  type: str
  help: "List of files to backup and symlink"
  when: false
  default: |
    $DOTFILES_PATH/.gitconfig|$DEST_PATH/.gitconfig
    {%- if os != "windows" %}
    $DOTFILES_PATH/Microsoft.PowerShell_profile.ps1|$PROFILE
    {%- else %}
    $DOTFILES_PATH/.zshrc|$DEST_PATH/.zshrc
    $DOTFILES_PATH/.p10k.zsh|$DEST_PATH/.p10k.zsh
    {%- endif %}

setup_script:
  type: str
  help: "Name of the setup script"
  default: "setup_once"
  when: false

backup_dir:
  type: str
  help: "Name of the backup directory"
  default: "backups"
  when: false

_tasks:
  - name: "Oneshot copy setup for Linux and MacOS"
    command: |
      if [ "$(dirname {{ _copier_conf.dst_path }})" != "$HOME" ] && [ "{{ _copier_conf.data.simulator }}" != "true" ]; then
          echo "ABORTED. Template must be initialized to a sub-directory inside $HOME."
          exit 1
      fi
      chmod +x ./{{ setup_script }}.sh
      ./{{ setup_script }}.sh
    when: "{{ _copier_operation == 'copy' and _copier_conf.os in ['linux', 'macos'] }}"
